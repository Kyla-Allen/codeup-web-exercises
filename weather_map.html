<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Application</title>
    <style>

        body{
            background-color: #00ABA9;
        }
        .container{
            width: 65%;
            display: block;
            margin: 0 auto;
            background-color: #5ead93;
            background-image: url("https://www.transparenttextures.com/patterns/fresh-snow.png");
            border: 2px solid black;
        }
        li {
            list-style: none;
            display: inline-block;
            margin: 0 20px;
        }
        #mapContainer{
            border: 2px solid black;
            margin: 0 auto;
        }
        #weather{
            margin: 0 auto;
        }
        .weatherBox{
            background-color: lightblue;
            border: 1px solid black;
            padding: 10px;
            color: black;
        }
    </style>
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-core.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-service.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-ui.js"></script>
    <script type="text/javascript" src="https://js.api.here.com/v3/3.0/mapsjs-mapevents.js"></script>
    <link rel="stylesheet" type="text/css"
          href="http://js.api.here.com/v3/3.0/mapsjs-ui.css" />

</head>
<body>

<div class="container">
    <h1 id="city"></h1>
<div id="weather"></div>
<div style="width: 640px; height: 480px" id="mapContainer"></div>
</div>
</body>

<script src="js/jquery-2.x-git.js"></script>
<script>

    "use strict";


    function updateMap (lat, long) {
        $.get({
            url: "http://api.openweathermap.org/data/2.5/forecast",
            data: {
                APPID: "1e83d08506f0696e00686ca86e685d93",
                lat: lat,
                lon: long,
                units: "imperial"
                //use lat and lon for latitude and longitude
            }
        }).done(function (data) {
            console.log(data);
            $('#city').html(data.city.name);
            $("#weather").html(getData(data));
        });
    }



    //MAP STUFF//

    var platform = new H.service.Platform({
        'app_id': 'spTWvUif2h571UglKIdt',
        'app_code': 'c8CbuoswzaP_OABI624HQA'
    });

    // Obtain the default map types from the platform object
    var maptypes = platform.createDefaultLayers();

    // Get default map types from the platform object:
    var defaultLayers = platform.createDefaultLayers();

    // Instantiate (and display) a map object:
    var map = new H.Map(
        document.getElementById('mapContainer'),
        maptypes.normal.map,
        {
            zoom: 10,
            center: { lat: 29.426567, lng: -98.4936 }
        });

    function addDraggableMarker(map, behavior){

        var marker = new H.map.Marker({ lat: 29.426567, lng: -98.4936 });
        // Ensure that the marker can receive drag events
        marker.draggable = true;
        map.addObject(marker);

        // disable the default draggability of the underlying map
        // when starting to drag a marker object:
        map.addEventListener('dragstart', function(ev) {
            var target = ev.target;
            if (target instanceof H.map.Marker) {
                behavior.disable();
            }
        }, false);


        // re-enable the default draggability of the underlying map
        // when dragging has completed
        map.addEventListener('dragend', function(ev) {
            var target = ev.target;
            if (target instanceof mapsjs.map.Marker) {
                behavior.enable();
            }
            updateMap(marker.getPosition().lat, marker.getPosition().lng);
        }, false);

        // Listen to the drag event and move the position of the marker
        // as necessary
        map.addEventListener('drag', function(ev) {
            var target = ev.target,
                pointer = ev.currentPointer;
            if (target instanceof mapsjs.map.Marker) {
                target.setPosition(map.screenToGeo(pointer.viewportX, pointer.viewportY));
            }
        }, false);
    }

    /**
     * Boilerplate map initialization code starts below:
     */

    //Step 3: make the map interactive
    // MapEvents enables the event system
    // Behavior implements default interactions for pan/zoom (also on mobile touch environments)
    var behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));

    // Step 4: Create the default UI:
    var ui = H.ui.UI.createDefault(map, defaultLayers, 'en-US');

    // Add the click event listener.
    addDraggableMarker(map, behavior);

////////////////////////////////////////////////////////////////////////////////////////////////////////////

    //getting the data and call the buildDiv function
    function getData(data){
        var html = '<ul>';
        for (var i = 0; i < 24; i += 8) {//we're only going up three days, so we're less than 25
            html+= '<li>';
            html += buildDiv (data.list[i].main.temp, data.list[i].weather[0].description, data.list[i].main.humidity
                ,data.list[i].wind.speed, data.list[i].main.pressure); //damn this function call is long. Try and refactor this later
            html+= '</li>';
        }
        html += '</ul>';
        return html;
    }

    //building the divs...
    function buildDiv(temp, desc, humid, wind, pressure){
        var html =  ' ';
        html += '<div class="weatherBox">';
        html += '<h2>' + temp + ' degrees </h2>';
        html += '<p> Current Weather: '+ desc + '</p>';
        html += '<p> Humidity: ' + humid + '</p>';
        html += '<p> Wind Speed: ' + wind + '</p>';
        html += '<p> Pressure: ' + pressure + '</p>';
        html += '</div>';
        return html;
    }




</script>
</html>